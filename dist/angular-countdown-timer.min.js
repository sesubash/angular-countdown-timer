angular.module("sesu.countdown",[]).directive("countdownTimer",["$sce",function(s){return{restrict:"EA",replace:!1,scope:{countdown:"=",interval:"=",active:"@",finishCallback:"&",endSoonCallback:"&"},template:"<span ng-bind-html='formatted'></span>",link:function(n,a,t){if(0==n.countdown)return void(angular.isDefined(n.finishCallback)&&n.$eval(n.finishCallback));var c,e,l=moment().add(n.countdown*n.interval),o=function(){e=window.setTimeout(function(){var s=moment(),a=l;c=moment(a,"DD/MM/YYYY HH:mm:ss").diff(moment(s,"DD/MM/YYYY HH:mm:ss")),i(),3e5>=c&&c>=299e3?angular.isDefined(n.endSoonCallback)&&n.$eval(n.endSoonCallback):void 0!=n.countdown&&0>=c&&(n.countdown=0,n.active=!1,angular.isDefined(n.finishCallback)&&n.$eval(n.finishCallback)),c>0&&o()},1e3/60)};n.active&&o(),n.$watch("active",function(s,a){s!==a&&(s===!0?n.countdown>0?o():n.active=!1:clearTimeout(e))}),n.$watch("countdown",function(){l=moment().add(n.countdown*n.interval)}),n.$on("timer-start",function(){o()});var i=function(){if(void 0!=c){var a=moment.duration(c);a.humanize();var t="days",e="hrs",l="min",o="sec";a.days()>0?n.formatted=s.trustAsHtml("<span class='ct-day'>"+a.days()+"</span><span class='ct-day-lbl'>"+t+"</span>:<span class='ct-hr'>"+a.hours()+"</span><span class='ct-hr-lbl'>"+e+"</span>:<span class='ct-min'>"+a.minutes()+"</span><span class='ct-min-lbl'>"+l+"</span>:<span class='ct-sec'>"+a.seconds()+"</span><span class='ct-sec-lbl'>"+o+"</span>"):a.days()<=0&&a.hours()>0?n.formatted=s.trustAsHtml("<span class='ct-hr'>"+a.hours()+"</span><span class='ct-hr-lbl'>"+e+"</span>:<span class='ct-min'>"+a.minutes()+"</span><span class='ct-min-lbl'>"+l+"</span>:<span class='ct-sec'>"+a.seconds()+"</span><span class='ct-sec-lbl'>"+o+"</span>"):0==a.days()&&0==a.hours()&&0==a.minutes()&&0==a.seconds()||(n.formatted=s.trustAsHtml("<span class='ct-min'>"+a.minutes()+"</span><span class='ct-min-lbl'>"+l+"</span>:<span class='ct-sec'>"+a.seconds()+"</span><span class='ct-sec-lbl'>"+o+"</span>")),n.$digest()}};n.$on("$destroy",function(){window.clearTimeout(e)})}}}]);